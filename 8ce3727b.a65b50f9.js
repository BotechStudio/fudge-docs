(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{71:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return d}));var a=n(2),r=n(6),o=(n(0),n(83)),c={id:"CMS",title:"CMS"},i={unversionedId:"CMS",id:"CMS",isDocsHomePage:!1,title:"CMS",description:"Intro",source:"@site/docs/CMS.md",slug:"/CMS",permalink:"/docs/CMS",version:"current",sidebar:"someSidebar",previous:{title:"Security and normalization",permalink:"/docs/data-security"},next:{title:"Deployment",permalink:"/docs/deployment"}},s=[{value:"Intro",id:"intro",children:[]},{value:"Add new collection",id:"add-new-collection",children:[]},{value:"Update the UI",id:"update-the-ui",children:[]}],l={rightToc:s};function d(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h3",{id:"intro"},"Intro"),Object(o.b)("p",null,"We have implemented in fudge a simple and easy to update ",Object(o.b)("strong",{parentName:"p"},"Control Management System")," that will help the platform admin to track, update and delete data directly from the DB and manage all the ",Object(o.b)("strong",{parentName:"p"},"collections")," that he holds."),Object(o.b)("p",null,"in order to view the admin section, please navigate to the ",Object(o.b)("strong",{parentName:"p"},"admin")," root folder."),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"More comprehensive overview can be found at the ",Object(o.b)("strong",{parentName:"p"},"Project structure")," section."))),Object(o.b)("h3",{id:"add-new-collection"},"Add new collection"),Object(o.b)("p",null,"In order to use the ",Object(o.b)("strong",{parentName:"p"},"CMS")," properly, the app collections should be added to the admin's CMS.\ndown below you will find explanation on how to do so, for this instance we will implement a ",Object(o.b)("strong",{parentName:"p"},"products")," collection.\nplease make sure to create a ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/adding-field-DB"}),"Schema")," before you continue reading this guide."),Object(o.b)("p",null,"First, we will create a products connector at ",Object(o.b)("strong",{parentName:"p"},"server > connectors")," wich will handle all of our server logic.\nthe connector should be a class and should ",Object(o.b)("strong",{parentName:"p"},"extend")," the base connector.\nthe base connector that we are extending to create our new connector (products) handles simple operations like get, create, update and etc."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'const getDB = require("../models/index.js");\n\nmodule.exports = class BaseConnector {\n  constructor(model, options = {}) {\n    this.model = getDB(model);\n    this.get = this.get.bind(this);\n    this.create = this.create.bind(this);\n    this.remove = this.remove.bind(this);\n    this.ftpConfig = options.ftpConfig;\n  }\n\n  normalizeValues(data) {\n    const result = {};\n    Object.keys(data).forEach((key) => {\n      let value = data[key];\n      if (value === "undefined") {\n        value = undefined;\n      }\n      result[key] = value;\n    });\n    return result;\n  }\n\n  get(filters) {\n    const query = this.model.find();\n    if (filters.id) {\n      query.where("_id").equals(filters.id);\n    }\n    return query.exec();\n  }\n\n  remove(data) {\n    return this.model.findByIdAndRemove(data).exec();\n  }\n\n  constructUpdateQuery(data) {\n    const query = {\n      $set: {},\n    };\n\n    Object.keys(data).forEach((key) => {\n      let value = data[key];\n      if (value === "undefined") {\n        query["$unset"] = query["$unset"] || {};\n        query["$unset"][key] = 1;\n      } else {\n        query["$set"][key] = value;\n      }\n    });\n    return query;\n  }\n\n  create(id, data) {\n    if (!id) {\n      delete data._id;\n      console.log("base: ", data);\n      return this.model.create(data);\n    } else {\n      const query = this.constructUpdateQuery(data);\n      return this.model.findByIdAndUpdate(id, query).exec();\n    }\n  }\n};\n')),Object(o.b)("p",null,"to implement those operations we dont need to create any other connector.\nin order to create new operations, like get a single document from the db, we will have to create a new connector with the correspond logic inside."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"class ProductsConnector extends BaseConnector {\n  constructor(props) {\n    super(props);\n  }\n\n  get(filters) {\n    const query = this.model.find({ _id: props.id });\n    query.select({ __v: 0 });\n    return query.exec();\n  }\n}\n")),Object(o.b)("p",null,"at the example above, the ",Object(o.b)("inlineCode",{parentName:"p"},"ProductsConnector")," retrieving a specific document from the products collection. fill free to add more functionality to the connector (like remove, update and etc)."),Object(o.b)("p",null,"after we have created the the relevant connector, we will continue and create a route.\ninside ",Object(o.b)("strong",{parentName:"p"},"server > controllers > data.js"),"."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'exports.fetch = function (req, res) {\n  const { isAdmin } = req.user;\n  if (!isAdmin) return res.send("User is not admin");\n\n  if (!req.query.collection) return res.send("error");\n\n  const queryField = req.query.collection;\n  const model = getConnector(queryField);\n  const query = model.get(req.query);\n\n  query\n    .then(function (docs) {\n      res.json(docs);\n    })\n    .catch((e) => {\n      res.status(500).send("Internal server error");\n    });\n};\n')),Object(o.b)("p",null,"pay attention, for security reasons please make sure to add the admin ",Object(o.b)("strong",{parentName:"p"},"authentication"),"\nto prevent from other users to reach this route, use the ",Object(o.b)("inlineCode",{parentName:"p"},"isAdmin")," field like above.\nmore information about admin authentication can be found at the ",Object(o.b)("strong",{parentName:"p"},"auth middleware")," section."),Object(o.b)("p",null,"as we can see, we are making use of the connector we have just created and getting back the ",Object(o.b)("strong",{parentName:"p"},"docs")," (can be change to any other logic or purpose)."),Object(o.b)("p",null,"make sure to add the route to the admin router wich located at ",Object(o.b)("strong",{parentName:"p"}," server > routers > admin.js"),", more about routes can be foind ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/add-end-point"}),"here"),"."),Object(o.b)("h3",{id:"update-the-ui"},"Update the UI"),Object(o.b)("p",null,"After we done with the ",Object(o.b)("strong",{parentName:"p"},"end-point and connectors")," setup we can continue to the UI.\ngenerally, we can display the data how we want (list, table and etc). ",Object(o.b)("br",null),"\nat this section, we will take a look at the ",Object(o.b)("strong",{parentName:"p"},"fornt-end")," and will display the data we get back from the server."),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Please navigate to ",Object(o.b)("strong",{parentName:"p"},"admin > app > models")," and create a folders named products.\nwe will implement all the UI inside that folder."))),Object(o.b)("p",null,"Inside the products folder, create 3 files."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"schema.js"),Object(o.b)("li",{parentName:"ul"},"products.js"),Object(o.b)("li",{parentName:"ul"},"product.js"),Object(o.b)("li",{parentName:"ul"},"index.js")),Object(o.b)("p",null,"let's open ",Object(o.b)("strong",{parentName:"p"},"schema.js")," and add some code inside:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'import {\n  TextField,\n  BooleanField,\n  LabelField,\n} from "../../../app/components/Fields";\nconst Schema = {\n  email: {\n    functionComponent: (props) => TextField(props),\n    formatName: "Email",\n  },\n  isAdmin: {\n    functionComponent: (props) => BooleanField(props),\n    formatName: "Is admin",\n  },\n  default: {\n    functionComponent: (props) => LabelField(props),\n  },\n};\n')),Object(o.b)("p",null,"as we can see, we are importing some input ",Object(o.b)("strong",{parentName:"p"},"components")," (can be replced to any component you want), those ",Object(o.b)("strong",{parentName:"p"},"inputs")," will placed at the view of ",Object(o.b)("strong",{parentName:"p"},"each")," item that we get from the server.\nmake sure to have a default field that will return generic label.\nthe format name will be displayed at the app (if you want to)."),Object(o.b)("p",null,"at the file ",Object(o.b)("strong",{parentName:"p"},"products.js")," we will display all the data we get from the server, in any way we want. please choose any structure you prefer (list, table and etc)."),Object(o.b)("p",null,"open the ",Object(o.b)("strong",{parentName:"p"},"product.js")," file and create a ",Object(o.b)("strong",{parentName:"p"},"react component"),", also please import the ",Object(o.b)("strong",{parentName:"p"},"schema")," from schema.js.\nas we can see down below, on every click on one of the documents at the data structure you picked (list or table) we will open the ",Object(o.b)("strong",{parentName:"p"},"product component"),". the product component will make a use of the components imported at the schema.js."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'const constructFields = () => {\n  const rows = Object.keys(initialValues).map((key) => {\n    const { formatName, functionComponent, ...props } =\n      Schema[key] || Schema["default"];\n    return (\n      <FlexRow key={key}>\n        <span>{formatName || capitalizeString(key)}</span>\n        <span>\n          {functionComponent({\n            value: initialValues[key],\n            refVal: register({ required: true }),\n            name: key,\n          })}\n        </span>\n      </FlexRow>\n    );\n  });\n  return rows;\n};\n')),Object(o.b)("p",null,"open the ",Object(o.b)("strong",{parentName:"p"},"index.js"),' file and import product.js and products.js.\nthis "container" file will make the switch between the two and make sure when we are choosing a document, the only document will be shown with the schema components.\nthe implementation will look somthing like this:'),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'{\n  view === "products" ? (\n    <Products products={users} onView={showForm} />\n  ) : (\n    <Product initialValues={item} saveItem={saveItem} deleteItem={deleteItem} />\n  );\n}\n')),Object(o.b)("p",null,"then, when we click on one of the documents a editable form will be open with the specific doc details."),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"A full example can be found at ",Object(o.b)("strong",{parentName:"p"},"admin > app > models > users"),", fudge's team have implemented all the logic above over there."))))}d.isMDXComponent=!0},83:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),d=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=d(n),u=a,m=p["".concat(c,".").concat(u)]||p[u]||b[u]||o;return n?r.a.createElement(m,i(i({ref:t},l),{},{components:n})):r.a.createElement(m,i({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,c=new Array(o);c[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,c[1]=i;for(var l=2;l<o;l++)c[l]=n[l];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);